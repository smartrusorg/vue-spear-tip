/*
Tagify v4.36.0 - tags input component (with local fixes)
By: Yair Even-Or <vsync.design@gmail.com>
https://github.com/yairEO/tagify

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

This Software may not be rebranded and sold as a library under any other name
other than "Tagify" (by owner) or as part of another library.
*/
var t="&#8203;";function e(Z,tt){(null==tt||tt>Z.length)&&(tt=Z.length);for(var te=0,ti=Array(tt);te<tt;te++)ti[te]=Z[te];return ti}function i(Z){return function(Z){if(Array.isArray(Z))return e(Z)}(Z)||function(Z){if("undefined"!=typeof Symbol&&null!=Z[Symbol.iterator]||null!=Z["@@iterator"])return Array.from(Z)}(Z)||function(Z,tt){if(Z){if("string"==typeof Z)return e(Z,tt);var te=Object.prototype.toString.call(Z).slice(8,-1);return("Object"===te&&Z.constructor&&(te=Z.constructor.name),"Map"===te||"Set"===te)?Array.from(te):"Arguments"===te||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(te)?e(Z,tt):void 0}}(Z)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n={isEnabled:function(){var Z;return null===(Z=window.TAGIFY_DEBUG)||void 0===Z||Z},log:function(){for(var Z,tt=arguments.length,te=Array(tt),ti=0;ti<tt;ti++)te[ti]=arguments[ti];this.isEnabled()&&(Z=console).log.apply(Z,["[Tagify]:"].concat(i(te)))},warn:function(){for(var Z,tt=arguments.length,te=Array(tt),ti=0;ti<tt;ti++)te[ti]=arguments[ti];this.isEnabled()&&(Z=console).warn.apply(Z,["[Tagify]:"].concat(i(te)))}},a=function(Z,tt,te,ti){return Z=""+Z,tt=""+tt,ti&&(Z=Z.trim(),tt=tt.trim()),te?Z==tt:Z.toLowerCase()==tt.toLowerCase()},s=function(Z,tt){return Z&&Array.isArray(Z)&&Z.map(function(Z){return o(Z,tt)})};function o(Z,tt){var te,ti={};for(te in Z)0>tt.indexOf(te)&&(ti[te]=Z[te]);return ti}function r(Z){return(new DOMParser).parseFromString(Z.trim(),"text/html").body.firstElementChild}function l(Z,tt){for(tt=tt||"previous";Z=Z[tt+"Sibling"];)if(3==Z.nodeType)return Z}function d(Z){return"string"==typeof Z?Z.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):Z}function c(Z){var tt=Object.prototype.toString.call(Z).split(" ")[1].slice(0,-1);return Z===Object(Z)&&"Array"!=tt&&"Function"!=tt&&"RegExp"!=tt&&"HTMLUnknownElement"!=tt}function u(Z,tt,te){var ti,tn;function ts(Z,tt){for(var te in tt)if(tt.hasOwnProperty(te)){if(c(tt[te])){c(Z[te])?ts(Z[te],tt[te]):Z[te]=Object.assign({},tt[te]);continue}if(Array.isArray(tt[te])){Z[te]=Object.assign([],tt[te]);continue}Z[te]=tt[te]}}return ti=Z,(null!=(tn=Object)&&"undefined"!=typeof Symbol&&tn[Symbol.hasInstance]?tn[Symbol.hasInstance](ti):ti instanceof tn)||(Z={}),ts(Z,tt),te&&ts(Z,te),Z}function g(){var Z=[],tt={},te=!0,ti=!1,tn=void 0;try{for(var ts,ta=arguments[Symbol.iterator]();!(te=(ts=ta.next()).done);te=!0){var to=ts.value,tr=!0,tl=!1,td=void 0;try{for(var tc,tu=to[Symbol.iterator]();!(tr=(tc=tu.next()).done);tr=!0){var tg=tc.value;c(tg)?tt[tg.value]||(Z.push(tg),tt[tg.value]=1):Z.includes(tg)||Z.push(tg)}}catch(th){tl=!0,td=th}finally{try{tr||null==tu.return||tu.return()}finally{if(tl)throw td}}}}catch(tp){ti=!0,tn=tp}finally{try{te||null==ta.return||ta.return()}finally{if(ti)throw tn}}return Z}function h(Z){return String.prototype.normalize?"string"==typeof Z?Z.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:Z}var p=function(){return/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)};function f(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(Z){return(Z^crypto.getRandomValues(new Uint8Array(1))[0]&15>>Z/4).toString(16)})}function v(Z){var tt,te=b.call(this,Z),ti=null==Z||null===(tt=Z.classList)||void 0===tt?void 0:tt.contains(this.settings.classNames.tag);return te&&ti}function m(Z){return b.call(this,Z)&&(null==Z?void 0:Z.closest(this.settings.classNames.tagSelector))}function b(Z){var tt;return(null==Z||null===(tt=Z.closest)||void 0===tt?void 0:tt.call(Z,this.settings.classNames.namespaceSelector))===this.DOM.scope}function y(Z,tt){var te=window.getSelection();return tt=tt||te.getRangeAt(0),"string"==typeof Z&&(Z=document.createTextNode(Z)),tt&&(tt.deleteContents(),tt.insertNode(Z)),Z}function w(Z,tt,te){return Z?(tt&&(Z.__tagifyTagData=te?tt:u({},Z.__tagifyTagData||{},tt)),Z.__tagifyTagData):(n.warn("tag element doesn't exist",{tagElm:Z,data:tt}),tt)}function T(Z){if(Z&&Z.parentNode){var tt=window.getSelection(),te=tt.getRangeAt(0);tt.rangeCount&&(te.setStartAfter(Z),te.collapse(!0),tt.removeAllRanges(),tt.addRange(te))}}function O(Z,tt){Z.forEach(function(Z){if(w(Z.previousSibling)||!Z.previousSibling){var te=document.createTextNode("​");Z.before(te),tt&&T(te)}})}var x={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:["blur","tab","enter"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,focusable:!0,focusInputOnRemove:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function(){},trim:!0,a11y:{focusableTags:!1,inputAriaLabel:"Tags input field"},mixMode:{insertAfterTag:"\xa0"},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownItemHidden:"tagify__dropdown__item--hidden",dropdownItemSelected:"tagify__dropdown__item--selected",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!0,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:function(){return Promise.resolve()},beforePaste:function(){return Promise.resolve()},suggestionClick:function(){return Promise.resolve()},beforeKeyDown:function(){return Promise.resolve()}}};function D(Z,tt,te){return tt in Z?Object.defineProperty(Z,tt,{value:te,enumerable:!0,configurable:!0,writable:!0}):Z[tt]=te,Z}function S(Z){for(var tt=1;tt<arguments.length;tt++){var te=null!=arguments[tt]?arguments[tt]:{},ti=Object.keys(te);"function"==typeof Object.getOwnPropertySymbols&&(ti=ti.concat(Object.getOwnPropertySymbols(te).filter(function(Z){return Object.getOwnPropertyDescriptor(te,Z).enumerable}))),ti.forEach(function(tt){D(Z,tt,te[tt])})}return Z}function I(Z,tt){return tt=null!=tt?tt:{},Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(tt)):(function(Z,tt){var te=Object.keys(Z);if(Object.getOwnPropertySymbols){var ti=Object.getOwnPropertySymbols(Z);te.push.apply(te,ti)}return te})(Object(tt)).forEach(function(te){Object.defineProperty(Z,te,Object.getOwnPropertyDescriptor(tt,te))}),Z}function E(Z,tt){(null==tt||tt>Z.length)&&(tt=Z.length);for(var te=0,ti=Array(tt);te<tt;te++)ti[te]=Z[te];return ti}function M(Z,tt,te){return tt in Z?Object.defineProperty(Z,tt,{value:te,enumerable:!0,configurable:!0,writable:!0}):Z[tt]=te,Z}function N(Z){return function(Z){if(Array.isArray(Z))return E(Z)}(Z)||function(Z){if("undefined"!=typeof Symbol&&null!=Z[Symbol.iterator]||null!=Z["@@iterator"])return Array.from(Z)}(Z)||function(Z,tt){if(Z){if("string"==typeof Z)return E(Z,tt);var te=Object.prototype.toString.call(Z).slice(8,-1);return("Object"===te&&Z.constructor&&(te=Z.constructor.name),"Map"===te||"Set"===te)?Array.from(te):"Arguments"===te||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(te)?E(Z,tt):void 0}}(Z)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(){for(var Z in this.dropdown={},this._dropdown)this.dropdown[Z]="function"==typeof this._dropdown[Z]?this._dropdown[Z].bind(this):this._dropdown[Z];this.dropdown.refs(),this.DOM.dropdown.__tagify=this}var C,_,k=(C=function(Z){for(var tt=1;tt<arguments.length;tt++){var te=null!=arguments[tt]?arguments[tt]:{},ti=Object.keys(te);"function"==typeof Object.getOwnPropertySymbols&&(ti=ti.concat(Object.getOwnPropertySymbols(te).filter(function(Z){return Object.getOwnPropertyDescriptor(te,Z).enumerable}))),ti.forEach(function(tt){M(Z,tt,te[tt])})}return Z}({},{events:{binding:function(){var Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],tt=this.dropdown.events.callbacks,te=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:tt.onKeyDown.bind(this),onMouseOver:tt.onMouseOver.bind(this),onMouseLeave:tt.onMouseLeave.bind(this),onClick:tt.onClick.bind(this),onScroll:tt.onScroll.bind(this)},ti=Z?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(document[ti]("scroll",te.position,!0),window[ti]("resize",te.position),window[ti]("keydown",te.onKeyDown)),this.DOM.dropdown[ti]("mouseover",te.onMouseOver),this.DOM.dropdown[ti]("mouseleave",te.onMouseLeave),this.DOM.dropdown[ti]("mousedown",te.onClick),this.DOM.dropdown.content[ti]("scroll",te.onScroll)},callbacks:{onKeyDown:function(Z){var tt=this;if(this.state.hasFocus&&!this.state.composing){var te=this.settings,ti=te.dropdown.includeSelectedTags,tn=this.DOM.dropdown.querySelector(te.classNames.dropdownItemActiveSelector),ts=this.dropdown.getSuggestionDataByNode(tn),ta="mix"==te.mode,to="select"==te.mode;te.hooks.beforeKeyDown(Z,{tagify:this}).then(function(tr){switch(Z.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":Z.preventDefault();var tl=tt.dropdown.getAllSuggestionsRefs(),td="ArrowUp"==Z.key||"Up"==Z.key;tn&&(tn=tt.dropdown.getNextOrPrevOption(tn,!td)),tn&&tn.matches(te.classNames.dropdownItemSelector)||(tn=tl[td?tl.length-1:0]),tt.dropdown.highlightOption(tn,!0);break;case"PageUp":case"PageDown":Z.preventDefault();var tc,tu=tt.dropdown.getAllSuggestionsRefs(),tg=Math.floor(tt.DOM.dropdown.content.clientHeight/(null===(tc=tu[0])||void 0===tc?void 0:tc.offsetHeight))||1,th="PageUp"===Z.key;if(tn){var tp=tu.indexOf(tn);tn=tu[th?Math.max(0,tp-tg):Math.min(tu.length-1,tp+tg)]}else tn=tu[0];tt.dropdown.highlightOption(tn,!0);break;case"Home":case"End":Z.preventDefault();var tf=tt.dropdown.getAllSuggestionsRefs();tn=tf["Home"===Z.key?0:tf.length-1],tt.dropdown.highlightOption(tn,!0);break;case"Escape":case"Esc":tt.dropdown.hide();break;case"ArrowRight":if(tt.state.actions.ArrowLeft||te.autoComplete.rightKey)return;case"Tab":var tv=!te.autoComplete.rightKey||!te.autoComplete.tabKey;if(!ta&&!to&&tn&&tv&&!tt.state.editing&&ts){Z.preventDefault();var tm=tt.dropdown.getMappedValue(ts);return tt.state.autoCompleteData=ts,tt.input.autocomplete.set.call(tt,tm),!1}return!0;case"Enter":Z.preventDefault(),tt.state.actions.selectOption=!0,setTimeout(function(){return tt.state.actions.selectOption=!1},100),te.hooks.suggestionClick(Z,{tagify:tt,tagData:ts,suggestionElm:tn}).then(function(){if(tn){var te=ti?tn:tt.dropdown.getNextOrPrevOption(tn,!td);tt.dropdown.selectOption(tn,Z,function(){if(te){var Z=te.getAttribute("value");te=tt.dropdown.getSuggestionNodeByValue(Z),tt.dropdown.highlightOption(te)}})}else tt.dropdown.hide(),ta||tt.addTags(tt.state.inputText.trim(),!0)}).catch(function(Z){return n.warn(Z)});break;case"Backspace":if(ta||tt.state.editing.scope)return;var tw=tt.input.raw.call(tt);""!=tw&&8203!=tw.charCodeAt(0)||(!0===te.backspace?tt.removeTags():"edit"==te.backspace&&setTimeout(tt.editTag.bind(tt),0))}})}},onMouseOver:function(Z){var tt=Z.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(tt)},onMouseLeave:function(Z){this.dropdown.highlightOption()},onClick:function(Z){var tt=this;if(0==Z.button&&Z.target!=this.DOM.dropdown&&Z.target!=this.DOM.dropdown.content){var te=Z.target.closest(this.settings.classNames.dropdownItemSelector),ti=this.dropdown.getSuggestionDataByNode(te);this.state.actions.selectOption=!0,setTimeout(function(){return tt.state.actions.selectOption=!1},100),this.settings.hooks.suggestionClick(Z,{tagify:this,tagData:ti,suggestionElm:te}).then(function(){te?tt.dropdown.selectOption(te,Z):tt.dropdown.hide()}).catch(function(Z){return n.warn(Z)})}},onScroll:function(Z){var tt=Z.target,te=tt.scrollTop/(tt.scrollHeight-tt.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(te)})}}},refilter:function(Z){Z=Z||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(Z),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},getSuggestionDataByNode:function(Z){for(var tt,te=Z&&Z.getAttribute("value"),ti=this.suggestedListItems.length;ti--;){if(c(tt=this.suggestedListItems[ti])&&tt.value==te)return tt;if(tt==te)return{value:tt}}},getSuggestionNodeByValue:function(Z){return this.dropdown.getAllSuggestionsRefs().find(function(tt){return tt.getAttribute("value")===Z})},getNextOrPrevOption:function(Z){var tt=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],te=this.dropdown.getAllSuggestionsRefs(),ti=te.findIndex(function(tt){return tt===Z});return tt?te[ti+1]:te[ti-1]},highlightOption:function(Z,tt){var te,ti=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(ti),this.state.ddItemElm.removeAttribute("aria-selected")),!Z)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);te=this.dropdown.getSuggestionDataByNode(Z),this.state.ddItemData=te,this.state.ddItemElm=Z,Z.classList.add(ti),Z.setAttribute("aria-selected",!0),tt&&(Z.parentNode.scrollTop=Z.clientHeight+Z.offsetTop-Z.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,te),this.dropdown.position())},selectOption:function(Z,tt,te){var ti=this,tn=this.settings,ts=tn.dropdown.includeSelectedTags,ta=tn.dropdown,to=ta.clearOnSelect,tr=ta.closeOnSelect;if(!Z)return this.addTags(this.state.inputText,!0),void(tr&&this.dropdown.hide());tt=tt||{};var tl=Z.getAttribute("value"),td="mix"==tn.mode,tc=this.suggestedListItems.find(function(Z){var tt;return(null!==(tt=Z.value)&&void 0!==tt?tt:Z)==tl});if(this.trigger("dropdown:select",{data:tc,elm:Z,event:tt}),tc||"noMatch"==tl){if(this.state.editing){var tu=this.normalizeTags([tc])[0];tc=tn.transformTag.call(this,tu)||tu,this.onEditTagDone(null,u({__isValid:!0},tc))}else this[td?"addMixTags":"addTags"]([tc||this.input.raw.call(this)],to);(td||this.DOM.input.parentNode)&&(setTimeout(function(){ti.DOM.input.focus(),ti.toggleFocusClass(!0)}),tr&&setTimeout(this.dropdown.hide.bind(this)),ts?te&&te():(Z.addEventListener("transitionend",function(){ti.dropdown.fillHeaderFooter(),setTimeout(function(){Z.remove(),ti.dropdown.refilter(),te&&te()},100)},{once:!0}),Z.classList.add(this.settings.classNames.dropdownItemHidden)))}else tr&&setTimeout(this.dropdown.hide.bind(this))},selectAll:function(Z){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems("");var tt=this.dropdown.filterListItems("");return Z||(tt=this.state.dropdown.suggestions),this.addTags(tt,!0),this},filterListItems:function(Z,tt){var te,ti,tn,ts,ta,to,tr=function(){var Z,tr,tl=void 0,td=void 0;Z=th[tw];var tp,tf=Object.keys(ti=(null!=(tr=Object)&&"undefined"!=typeof Symbol&&tr[Symbol.hasInstance]?tr[Symbol.hasInstance](Z):Z instanceof tr)?th[tw]:{value:th[tw]}).some(function(Z){return tm.includes(Z)})?tm:["value"];tc.fuzzySearch&&!tt.exact?(ts=tf.reduce(function(Z,tt){return Z+" "+(ti[tt]||"")},"").toLowerCase().trim(),tc.accentedSearch&&(ts=h(ts),to=h(to)),tl=0==ts.indexOf(to),td=ts===to,tp=ts,tn=to.toLowerCase().split(" ").every(function(Z){return tp.includes(Z.toLowerCase())})):(tl=!0,tn=tf.some(function(Z){var te=""+(ti[Z]||"");return tc.accentedSearch&&(te=h(te),to=h(to)),tc.caseSensitive||(te=te.toLowerCase()),td=te===to,tt.exact?te===to:0==te.indexOf(to)})),ta=!tc.includeSelectedTags&&te.isTagDuplicate(c(ti)?ti.value:ti),tn&&!ta&&(td&&tl?tg.push(ti):"startsWith"==tc.sortby&&tl?tu.unshift(ti):tu.push(ti))},tl=this,td=this.settings,tc=td.dropdown,tu=(tt=tt||{},[]),tg=[],th=td.whitelist,tp=tc.maxItems>=0?tc.maxItems:1/0,tf=tc.includeSelectedTags,tv="function"==typeof tc.sortby,tm=tc.searchKeys,tw=0;if(!(Z="select"==td.mode&&this.value.length&&this.value[0][td.tagTextProp]==Z?"":Z)||!tm.length){tu=tf?th:th.filter(function(Z){return!tl.isTagDuplicate(c(Z)?Z.value:Z)});var tT=tv?tc.sortby(tu,to):tu.slice(0,tp);return this.state.dropdown.suggestions=tT,tT}for(to=tc.caseSensitive?""+Z:(""+Z).toLowerCase();tw<th.length;tw++)te=this,tr();return this.state.dropdown.suggestions=tg.concat(tu),tT=tv?tc.sortby(tg.concat(tu),to):tg.concat(tu).slice(0,tp),this.state.dropdown.suggestions=tT,tT},getMappedValue:function(Z){var tt=this.settings.dropdown.mapValueTo;return tt?"function"==typeof tt?tt(Z):Z[tt]||Z.value:Z.value},createListHTML:function(Z){var tt=this;return u([],Z).map(function(Z,te){"string"!=typeof Z&&"number"!=typeof Z||(Z={value:Z});var ti=tt.dropdown.getMappedValue(Z);return ti="string"==typeof ti&&tt.settings.dropdown.escapeHTML?d(ti):ti,tt.settings.templates.dropdownItem.apply(tt,[I(S({},Z),{mappedValue:ti}),tt])}).join("")}}),_=_={refs:function(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-wrapper']")},getHeaderRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-header']")},getFooterRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-footer']")},getAllSuggestionsRefs:function(){return N(this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector))},show:function(Z){var tt,te,ti,tn=this,ts=this.settings,ta="mix"==ts.mode&&!ts.enforceWhitelist,to=!ts.whitelist||!ts.whitelist.length,tr="manual"==ts.dropdown.position;if(Z=void 0===Z?this.state.inputText:Z,!(to&&!ta&&!ts.templates.dropdownItemNoMatch||!1===ts.dropdown.enabled||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(Z),Z&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",Z),ts.templates.dropdownItemNoMatch&&(ti=ts.templates.dropdownItemNoMatch.call(this,{value:Z}))),!ti){if(this.suggestedListItems.length)Z&&ta&&!this.state.editing.scope&&!a(this.suggestedListItems[0].value,Z)&&this.suggestedListItems.unshift({value:Z});else{if(!Z||!ta||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:Z}]}te=""+(c(tt=this.suggestedListItems[0])?tt.value:tt),ts.autoComplete&&te&&0==te.indexOf(Z)&&this.input.autocomplete.suggest.call(this,tt)}this.dropdown.fill(ti),ts.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(ts.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=Z||!0,this.state.dropdown.query=Z,this.setStateSelection(),tr||setTimeout(function(){tn.dropdown.position(),tn.dropdown.render()}),setTimeout(function(){tn.trigger("dropdown:show",tn.DOM.dropdown)})}},hide:function(Z){var tt=this,te=this.DOM,ti=te.scope,tn=te.dropdown,ts="manual"==this.settings.dropdown.position&&!Z;if(tn&&document.body.contains(tn)&&!ts)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),ti.setAttribute("aria-expanded",!1),tn.parentNode.removeChild(tn),setTimeout(function(){tt.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",tn),this},toggle:function(Z){this.dropdown[this.state.dropdown.visible&&!Z?"hide":"show"]()},getAppendTarget:function(){var Z=this.settings.dropdown;return"function"==typeof Z.appendTarget?Z.appendTarget():Z.appendTarget},render:function(){var Z,tt,te,ti=this,tn=((te=(Z=this.DOM.dropdown).cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(te),tt=te.clientHeight,te.parentNode.removeChild(te),tt),ts=this.settings,ta=this.dropdown.getAppendTarget();return!1===ts.dropdown.enabled||(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(ts.classNames.dropdownInital),this.dropdown.position(tn),ta.appendChild(this.DOM.dropdown),setTimeout(function(){return ti.DOM.dropdown.classList.remove(ts.classNames.dropdownInital)}))),this},fill:function(Z){Z="string"==typeof Z?Z:this.dropdown.createListHTML(Z||this.suggestedListItems);var tt,te=this.settings.templates.dropdownContent.call(this,Z);this.DOM.dropdown.content.innerHTML=(tt=te)?tt.replace(/\>[\r\n ]+\</g,"><").split(/>\s+</).join("><").trim():""},fillHeaderFooter:function(){var Z=this.dropdown.filterListItems(this.state.dropdown.query),tt=this.parseTemplate("dropdownHeader",[Z]),te=this.parseTemplate("dropdownFooter",[Z]),ti=this.dropdown.getHeaderRef(),tn=this.dropdown.getFooterRef();tt&&(null==ti||ti.parentNode.replaceChild(tt,ti)),te&&(null==tn||tn.parentNode.replaceChild(te,tn))},position:function(Z){var tt=this.settings.dropdown,te=this.dropdown.getAppendTarget();if("manual"!=tt.position&&te){var ti,tn,ts,ta,to,tr,tl,td,tc,tu,tg=this.DOM.dropdown,th=tt.RTL,tp=te===document.body,tf=te===this.DOM.scope,tv=tp?window.pageYOffset:te.scrollTop,tm=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,tw=tm.clientHeight,tT=Math.max(tm.clientWidth||0,window.innerWidth||0),ty=tT>480?tt.position:"all",tb=this.DOM["input"==ty?"input":"scope"];if(Z=Z||tg.clientHeight,this.state.dropdown.visible){if("text"==ty?(ts=(ti=function(){var Z=document.getSelection();if(Z.rangeCount){var tt,te,ti=Z.getRangeAt(0),tn=ti.startContainer,ts=ti.startOffset;if(ts>0)return(te=document.createRange()).setStart(tn,ts-1),te.setEnd(tn,ts),{left:(tt=te.getBoundingClientRect()).right,top:tt.top,bottom:tt.bottom};if(tn.getBoundingClientRect)return tn.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,tn=ti.top,ta=ti.left,to="auto"):(tr=function(Z){var tt=0,te=0;for(Z=Z.parentNode;Z&&Z!=tm;)tt+=Z.offsetTop||0,te+=Z.offsetLeft||0,Z=Z.parentNode;return{top:tt,left:te}}(te),ti=tb.getBoundingClientRect(),tn=tf?-1:ti.top-tr.top,ts=(tf?ti.height:ti.bottom-tr.top)-1,ta=tf?-1:ti.left-tr.left,to=ti.width+"px"),!tp){var t$,tx=function(){for(var Z=0,te=tt.appendTarget.parentNode;te;)Z+=te.scrollTop||0,te=te.parentNode;return Z}();tn+=tx,ts+=tx}tn=Math.floor(tn),ts=Math.ceil(ts),td=tT-ta<120,tc=((tl=null!==(t$=tt.placeAbove)&&void 0!==t$?t$:tw-ti.bottom<Z)?tn:ts)+tv,tu=ta+(th&&ti.width||0)+window.pageXOffset,tu="text"==ty&&td?"right: 0;":"left: ".concat(tu,"px;"),tg.style.cssText="".concat(tu," top: ").concat(tc,"px; min-width: ").concat(to,"; max-width: ").concat(to),tg.setAttribute("placement",tl?"top":"bottom"),tg.setAttribute("position",ty)}}}},Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(_)):(function(Z,tt){var te=Object.keys(Z);if(Object.getOwnPropertySymbols){var ti=Object.getOwnPropertySymbols(Z);te.push.apply(te,ti)}return te})(Object(_)).forEach(function(Z){Object.defineProperty(C,Z,Object.getOwnPropertyDescriptor(_,Z))}),C),L="@yaireo/tagify/",P={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},j={wrapper:function(Z,tt){return'<tags class="'.concat(tt.classNames.namespace," ").concat(tt.mode?"".concat(tt.classNames[tt.mode+"Mode"]):""," ").concat(Z.className,'"\n                    ').concat(tt.readonly?"readonly":"","\n                    ").concat(tt.disabled?"disabled":"","\n                    ").concat(tt.required?"required":"","\n                    ").concat("select"===tt.mode?"spellcheck='false'":"",'\n                    tabIndex="-1">\n                    ').concat(this.settings.templates.input.call(this),"\n                ").concat(t,"\n        </tags>")},input:function(){var Z=this.settings,tt=Z.placeholder||t;return"<span ".concat(!Z.readonly&&Z.userInput?"contenteditable":"",' data-can-editable tabIndex="0" data-placeholder="').concat(tt,'" aria-placeholder="').concat(Z.placeholder||"",'"\n                    class="').concat(Z.classNames.input,'"\n                    role="textbox"\n                    autocapitalize="false"\n                    autocorrect="off"\n                    aria-label="').concat(Z.a11y.inputAriaLabel,'"\n                    aria-autocomplete="both"\n                    aria-multiline="').concat("mix"==Z.mode,'"></span>')},tag:function(Z,tt){var te=tt.settings;return'<tag title="'.concat(Z.title||Z.value,"\"\n                    contenteditable='false'\n                    tabIndex=\"").concat(te.a11y.focusableTags?0:-1,'"\n                    class="').concat(te.classNames.tag," ").concat(Z.class||"",'"\n                    ').concat(this.getAttributes(Z),">\n            <x title='' tabIndex=\"").concat(te.a11y.focusableTags?0:-1,'" class="').concat(te.classNames.tagX,"\" role='button' aria-label='remove tag'></x>\n            <div>\n                <span ").concat("select"===te.mode&&te.userInput?"contenteditable='true'":"",' autocapitalize="false" autocorrect="off" spellcheck=\'false\' class="').concat(te.classNames.tagText,'">').concat(Z[te.tagTextProp]||Z.value,"</span>\n            </div>\n        </tag>")},dropdown:function(Z){var tt=Z.dropdown,te="manual"==tt.position;return'<div class="'.concat(te?"":Z.classNames.dropdown," ").concat(tt.classname,'" role="listbox" aria-labelledby="dropdown" dir="').concat(tt.RTL?"rtl":"","\">\n                    <div data-selector='tagify-suggestions-wrapper' class=\"").concat(Z.classNames.dropdownWrapper,'"></div>\n                </div>')},dropdownContent:function(Z){var tt=this.settings.templates,te=this.state.dropdown.suggestions;return"\n            ".concat(tt.dropdownHeader.call(this,te),"\n            ").concat(Z,"\n            ").concat(tt.dropdownFooter.call(this,te),"\n        ")},dropdownItem:function(Z){return"<div ".concat(this.getAttributes(Z),"\n                    class='").concat(this.settings.classNames.dropdownItem," ").concat(this.isTagDuplicate(Z.value)?this.settings.classNames.dropdownItemSelected:""," ").concat(Z.class||"",'\'\n                    tabindex="0"\n                    role="option">').concat(Z.mappedValue||Z.value,"</div>")},dropdownHeader:function(Z){return"<header data-selector='tagify-suggestions-header' class=\"".concat(this.settings.classNames.dropdownHeader,'"></header>')},dropdownFooter:function(Z){var tt=Z.length-this.settings.dropdown.maxItems;return tt>0?"<footer data-selector='tagify-suggestions-footer' class=\"".concat(this.settings.classNames.dropdownFooter,'">\n                ').concat(tt," more items. Refine your search.\n            </footer>"):""},dropdownItemNoMatch:null};function V(Z,tt){(null==tt||tt>Z.length)&&(tt=Z.length);for(var te=0,ti=Array(tt);te<tt;te++)ti[te]=Z[te];return ti}function R(Z,tt){return null!=tt&&"undefined"!=typeof Symbol&&tt[Symbol.hasInstance]?!!tt[Symbol.hasInstance](Z):Z instanceof tt}function F(Z,tt){return function(Z){if(Array.isArray(Z))return Z}(Z)||function(Z,tt){var te=null==Z?null:"undefined"!=typeof Symbol&&Z[Symbol.iterator]||Z["@@iterator"];if(null!=te){var ti,tn,ts=[],ta=!0,to=!1;try{for(te=te.call(Z);!(ta=(ti=te.next()).done)&&(ts.push(ti.value),!tt||ts.length!==tt);ta=!0);}catch(tr){to=!0,tn=tr}finally{try{ta||null==te.return||te.return()}finally{if(to)throw tn}}return ts}}(Z,tt)||function(Z,tt){if(Z){if("string"==typeof Z)return V(Z,tt);var te=Object.prototype.toString.call(Z).slice(8,-1);return("Object"===te&&Z.constructor&&(te=Z.constructor.name),"Map"===te||"Set"===te)?Array.from(te):"Arguments"===te||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(te)?V(Z,tt):void 0}}(Z,tt)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(Z,tt){(null==tt||tt>Z.length)&&(tt=Z.length);for(var te=0,ti=Array(tt);te<tt;te++)ti[te]=Z[te];return ti}function B(Z,tt,te){return tt in Z?Object.defineProperty(Z,tt,{value:te,enumerable:!0,configurable:!0,writable:!0}):Z[tt]=te,Z}function W(Z,tt){return null!=tt&&"undefined"!=typeof Symbol&&tt[Symbol.hasInstance]?!!tt[Symbol.hasInstance](Z):Z instanceof tt}function q(Z,tt){return tt=null!=tt?tt:{},Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(tt)):(function(Z,tt){var te=Object.keys(Z);if(Object.getOwnPropertySymbols){var ti=Object.getOwnPropertySymbols(Z);te.push.apply(te,ti)}return te})(Object(tt)).forEach(function(te){Object.defineProperty(Z,te,Object.getOwnPropertyDescriptor(tt,te))}),Z}function U(Z){return function(Z){if(Array.isArray(Z))return H(Z)}(Z)||function(Z){if("undefined"!=typeof Symbol&&null!=Z[Symbol.iterator]||null!=Z["@@iterator"])return Array.from(Z)}(Z)||function(Z,tt){if(Z){if("string"==typeof Z)return H(Z,tt);var te=Object.prototype.toString.call(Z).slice(8,-1);return("Object"===te&&Z.constructor&&(te=Z.constructor.name),"Map"===te||"Set"===te)?Array.from(te):"Arguments"===te||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(te)?H(Z,tt):void 0}}(Z)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var K={customBinding:function(){var Z=this;this.customEventsList.forEach(function(tt){Z.on(tt,Z.settings.callbacks[tt])})},binding:function(){var Z,tt=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],te=this.settings,ti=this.events.callbacks,tn=tt?"addEventListener":"removeEventListener";if(!(this.state.mainEvents&&tt||te.disabled||te.readonly)){for(var ts in this.state.mainEvents=tt,tt&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),Z=this.listeners.main=this.listeners.main||{keydown:["input",ti.onKeydown.bind(this)],click:["scope",ti.onClickScope.bind(this)],dblclick:"select"!=te.mode&&["scope",ti.onDoubleClickScope.bind(this)],paste:["input",ti.onPaste.bind(this)],drop:["input",ti.onDrop.bind(this)],compositionstart:["input",ti.onCompositionStart.bind(this)],compositionend:["input",ti.onCompositionEnd.bind(this)]})Z[ts]&&this.DOM[Z[ts][0]][tn](ts,Z[ts][1]);var ta=this.listeners.main.inputMutationObserver||new MutationObserver(ti.onInputDOMChange.bind(this));ta.disconnect(),"mix"==te.mode&&ta.observe(this.DOM.input,{childList:!0}),this.events.bindOriginaInputListener.call(this),tt&&(this.listeners.main=void 0)}},bindOriginaInputListener:function(Z){this.listeners.main&&(clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(this.events.callbacks.observeOriginalInputValue.bind(this),(Z||0)+500))},bindGlobal:function(Z){var tt,te=this.events.callbacks,ti=Z?"removeEventListener":"addEventListener";if(this.listeners&&(Z||!this.listeners.global)){this.listeners.global=this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:te[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:te.onWindowKeyDown.bind(this)},{type:"focusin",target:this.DOM.scope,cb:te.onFocusBlur.bind(this)},{type:"focusout",target:this.DOM.scope,cb:te.onFocusBlur.bind(this)},{type:"click",target:document,cb:te.onClickAnywhere.bind(this),useCapture:!0}];var tn=!0,ts=!1,ta=void 0;try{for(var to,tr=this.listeners.global[Symbol.iterator]();!(tn=(to=tr.next()).done);tn=!0)(tt=to.value).target[ti](tt.type,tt.cb,!!tt.useCapture)}catch(tl){ts=!0,ta=tl}finally{try{tn||null==tr.return||tr.return()}finally{if(ts)throw ta}}Z&&(this.listeners.global=void 0)}},unbindGlobal:function(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur:function(Z){var tt,te,ti=this.settings,tn=m.call(this,Z.relatedTarget),ts=v.call(this,Z.target),ta=Z.target.classList.contains(ti.classNames.tagX),to="focusin"==Z.type,tr="focusout"==Z.type;ta&&"mix"!=ti.mode&&ti.focusInputOnRemove&&this.DOM.input.focus(),tn&&to&&!ts&&!ta&&this.toggleFocusClass(this.state.hasFocus=+new Date);var tl=Z.target?this.trim(this.DOM.input.textContent):"",td=null===(te=this.value)||void 0===te||null===(tt=te[0])||void 0===tt?void 0:tt[ti.tagTextProp],tc=ti.dropdown.enabled>=0,tu={relatedTarget:Z.relatedTarget},tg=this.state.actions.selectOption&&(tc||!ti.dropdown.closeOnSelect),th=this.state.actions.addNew&&tc;if(tr){if(Z.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),ti.onChangeAfterBlur&&this.triggerChangeEvent()}if(!(tg||th||ta)){if(this.state.hasFocus=!(!to&&!tn)&&+new Date,this.toggleFocusClass(this.state.hasFocus),"mix"!=ti.mode){if(to){if(!ti.focusable)return;var tp=0===ti.dropdown.enabled&&!this.state.dropdown.visible,tf=this.DOM.scope.querySelector(this.settings.classNames.tagTextSelector);return this.trigger("focus",tu),void(tp&&!ts&&(this.dropdown.show(this.value.length?"":void 0),"select"===ti.mode&&this.setRangeAtStartEnd(!1,tf)))}if(tr){if(this.trigger("blur",tu),this.loading(!1),"select"==ti.mode){if(this.value.length){var tv=this.getTagElms()[0];tl=this.trim(tv.textContent)}td===tl&&(tl="")}tl&&!this.state.actions.selectOption&&ti.addTagOnBlur&&ti.addTagOn.includes("blur")&&this.addTags(tl,!0)}tn||(this.DOM.input.removeAttribute("style"),this.dropdown.hide())}else to?this.trigger("focus",tu):tr&&(this.trigger("blur",tu),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())}},onCompositionStart:function(Z){this.state.composing=!0},onCompositionEnd:function(Z){this.state.composing=!1},onWindowKeyDown:function(Z){var tt,te=this.settings,ti=document.activeElement,tn=m.call(this,ti)&&this.DOM.scope.contains(ti),ts=ti===this.DOM.input,ta=tn&&ti.hasAttribute("readonly"),to=this.DOM.scope.querySelector(this.settings.classNames.tagTextSelector),tr=this.state.dropdown.visible;if(("Tab"===Z.key&&tr||this.state.hasFocus||tn&&!ta)&&!ts){tt=ti.nextElementSibling;var tl=Z.target.classList.contains(te.classNames.tagX);switch(Z.key){case"Backspace":te.readonly||this.state.editing||(this.removeTags(ti),(tt||this.DOM.input).focus());break;case"Enter":if(tl)return void this.removeTags(Z.target.parentNode);te.a11y.focusableTags&&v.call(this,ti)&&setTimeout(this.editTag.bind(this),0,ti);break;case"ArrowDown":this.state.dropdown.visible||"mix"==te.mode||this.dropdown.show();break;case"Tab":null==to||to.focus()}}},onKeydown:function(Z){var tt=this,te=this.settings;if(!this.state.composing&&te.userInput){"select"==te.mode&&te.enforceWhitelist&&this.value.length&&"Tab"!=Z.key&&Z.preventDefault();var ti=this.trim(Z.target.textContent);this.trigger("keydown",{event:Z}),te.hooks.beforeKeyDown(Z,{tagify:this}).then(function(tn){if("mix"==te.mode){switch(Z.key){case"Left":case"ArrowLeft":tt.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(tt.state.editing)return;var ts=document.getSelection(),ta="Delete"==Z.key&&ts.anchorOffset==(ts.anchorNode.length||0),to=ts.anchorNode.previousSibling,tr=1==ts.anchorNode.nodeType||!ts.anchorOffset&&to&&1==to.nodeType&&ts.anchorNode.previousSibling;!function(Z){var tt=document.createElement("div");Z.replace(/\&#?[0-9a-z]+;/gi,function(Z){return tt.innerHTML=Z,tt.innerText})}(tt.DOM.input.innerHTML);var tl,td,tc,tu=tt.getTagElms(),tg=1===ts.anchorNode.length&&"​"==ts.anchorNode.nodeValue;if("edit"==te.backspace&&tr)return tl=1==ts.anchorNode.nodeType?null:ts.anchorNode.previousElementSibling,setTimeout(tt.editTag.bind(tt),0,tl),void Z.preventDefault();if(p()&&W(tr,Element))return tc=l(tr),tr.hasAttribute("readonly")||tr.remove(),tt.DOM.input.focus(),void setTimeout(function(){T(tc),tt.DOM.input.click()});if("BR"==ts.anchorNode.nodeName)return;if((ta||tr)&&1==ts.anchorNode.nodeType?td=0==ts.anchorOffset?ta?tu[0]:null:tu[Math.min(tu.length,ts.anchorOffset)-1]:ta?td=ts.anchorNode.nextElementSibling:W(tr,Element)&&(td=tr),3==ts.anchorNode.nodeType&&!ts.anchorNode.nodeValue&&ts.anchorNode.previousElementSibling&&Z.preventDefault(),(tr||ta)&&!te.backspace||"Range"!=ts.type&&!ts.anchorOffset&&ts.anchorNode==tt.DOM.input&&"Delete"!=Z.key)return void Z.preventDefault();if("Range"!=ts.type&&td&&td.hasAttribute("readonly"))return void T(l(td));"Delete"==Z.key&&tg&&w(ts.anchorNode.nextSibling)&&tt.removeTags(ts.anchorNode.nextSibling);break;case"Enter":if(Z.preventDefault(),tt.state.tag)return;var th=window.getSelection();th.getRangeAt(0).insertNode(document.createElement("br")),th.collapseToEnd()}return!0}var tp="manual"==te.dropdown.position;switch(Z.key){case"Backspace":"select"==te.mode&&te.enforceWhitelist&&tt.value.length?tt.removeTags():tt.state.dropdown.visible&&"manual"!=te.dropdown.position||""!=Z.target.textContent&&8203!=ti.charCodeAt(0)||(!0===te.backspace?tt.removeTags():"edit"==te.backspace&&setTimeout(tt.editTag.bind(tt),0));break;case"Esc":case"Escape":if(tt.state.dropdown.visible)return;Z.target.blur();break;case"Down":case"ArrowDown":tt.state.dropdown.visible||tt.dropdown.show();break;case"ArrowRight":var tf=tt.state.inputSuggestion||tt.state.ddItemData;if(tf&&te.autoComplete.rightKey)return void tt.addTags([tf],!0);break;case"Tab":if(!te.addTagOn.includes(Z.key.toLowerCase()))break;case"Enter":if(tt.state.dropdown.visible&&!tp)return;var tv=tt.state.autoCompleteData||ti;if(!tv&&"Tab"===Z.key)return!0;Z.preventDefault(),setTimeout(function(){tt.state.dropdown.visible&&!tp||tt.state.actions.selectOption||!te.addTagOn.includes(Z.key.toLowerCase())||(tt.addTags([tv],!0),tt.state.autoCompleteData=null)})}}).catch(function(Z){return Z})}},onInput:function(Z){this.postUpdate();var tt=this.settings;if("mix"==tt.mode)return this.events.callbacks.onMixTagsInput.call(this,Z);var te=this.input.normalize.call(this,void 0,{trim:!1}),ti=te.length>=tt.dropdown.enabled,tn={value:te,inputElm:this.DOM.input},ts=this.validateTag({value:te});"select"==tt.mode&&this.toggleScopeValidation(ts),tn.isValid=ts,this.state.inputText!=te&&(this.input.set.call(this,te,!1),-1!=te.search(tt.delimiters)?this.addTags(te)&&this.input.set.call(this):tt.dropdown.enabled>=0&&this.dropdown[ti?"show":"hide"](te),this.trigger("input",tn))},onMixTagsInput:function(Z){var tt,te,ti,tn,ts,ta,to,tr,tl=this,td=this.settings,tc=this.value.length,tu=this.getTagElms(),tg=document.createDocumentFragment(),th=window.getSelection().getRangeAt(0),tp=[].map.call(tu,function(Z){return w(Z).value});if("deleteContentBackward"==Z.inputType&&p()&&this.events.callbacks.onKeydown.call(this,{target:Z.target,key:"Backspace"}),O(this.getTagElms()),this.value.slice().forEach(function(Z){Z.readonly&&!tp.includes(Z.value)&&tg.appendChild(tl.createTagElem(Z))}),tg.childNodes.length&&(th.insertNode(tg),this.setRangeAtStartEnd(!1,tg.lastChild)),tu.length!=tc)return this.value=[].map.call(this.getTagElms(),function(Z){return w(Z)}),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(ta=window.getSelection()).rangeCount>0&&3==ta.anchorNode.nodeType){if((th=ta.getRangeAt(0).cloneRange()).collapse(!0),th.setStart(ta.focusNode,0),ti=(tt=th.toString().slice(0,th.endOffset)).split(td.pattern).length-1,(te=tt.match(td.pattern))&&(tn=tt.slice(tt.lastIndexOf(te[te.length-1]))),tn){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:tn.match(td.pattern)[0],value:tn.replace(td.pattern,"")},this.state.tag.baseOffset=ta.baseOffset-this.state.tag.value.length,tr=this.state.tag.value.match(td.delimiters))return this.state.tag.value=this.state.tag.value.replace(td.delimiters,""),this.state.tag.delimiters=tr[0],this.addTags(this.state.tag.value,td.dropdown.clearOnSelect),void this.dropdown.hide();ts=this.state.tag.value.length>=td.dropdown.enabled;try{to=(to=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&to.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(tf){}(to||ti<this.state.mixMode.matchedPatternCount)&&(ts=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=ti}setTimeout(function(){tl.update({withoutChangeEvent:!0}),tl.trigger("input",u({},tl.state.tag,{textContent:tl.DOM.input.textContent})),tl.state.tag&&tl.dropdown[ts?"show":"hide"](tl.state.tag.value)},10)},onInputIE:function(Z){var tt=this;setTimeout(function(){tt.events.callbacks.onInput.call(tt,Z)})},observeOriginalInputValue:function(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere:function(Z){if(Z.target!=this.DOM.scope&&!this.DOM.scope.contains(Z.target)){this.toggleFocusClass(!1),this.state.hasFocus=!1;var tt=Z.target.closest(this.settings.classNames.dropdownSelector);(null==tt?void 0:tt.__tagify)!=this&&this.dropdown.hide()}},onClickScope:function(Z){var tt=this.settings,te=Z.target.closest("."+tt.classNames.tag);Z.target,this.DOM.scope;var ti=+new Date-this.state.hasFocus;if(!Z.target.classList.contains(tt.classNames.tagX))return te&&!this.state.editing?(this.trigger("click",{tag:te,index:this.getNodeIndex(te),data:w(te),event:Z}),void(1!==tt.editTags&&1!==tt.editTags.clicks&&"select"!=tt.mode||this.events.callbacks.onDoubleClickScope.call(this,Z))):void(Z.target==this.DOM.input&&("mix"==tt.mode&&this.fixFirefoxLastTagNoCaret(),ti>500||!tt.focusable)?this.state.dropdown.visible?this.dropdown.hide():0===tt.dropdown.enabled&&"mix"!=tt.mode&&this.dropdown.show(this.value.length?"":void 0):"select"!=tt.mode||0!==tt.dropdown.enabled||this.state.dropdown.visible||(this.events.callbacks.onDoubleClickScope.call(this,q(function(Z){for(var tt=1;tt<arguments.length;tt++){var te=null!=arguments[tt]?arguments[tt]:{},ti=Object.keys(te);"function"==typeof Object.getOwnPropertySymbols&&(ti=ti.concat(Object.getOwnPropertySymbols(te).filter(function(Z){return Object.getOwnPropertyDescriptor(te,Z).enumerable}))),ti.forEach(function(tt){B(Z,tt,te[tt])})}return Z}({},Z),{target:this.getTagElms()[0]})),tt.userInput||this.dropdown.show()));this.removeTags(Z.target.parentNode)},onPaste:function(Z){var tt=this;Z.preventDefault();var te,ti,tn,ts=this.settings;if(!ts.userInput)return!1;ts.readonly||(tn=(ti=Z.clipboardData||window.clipboardData).getData("Text"),ts.hooks.beforePaste(Z,{tagify:this,pastedText:tn,clipboardData:ti}).then(function(ts){if(void 0===ts&&(ts=tn),ts){if("mix"==tt.settings.mode){if(tt.settings.pasteAsTags){var ta=tt.convertPastedTextToMixTags(ts),to=tt.parseMixTags(ta,{skipDOM:!0}),tr=to.__tagifyTagsData||[];tt.injectAtCaret(to,window.getSelection().getRangeAt(0)),tr.forEach(function(Z){return tt.value.push(Z)});var tl=tt.getTagElms().slice(-tr.length);tl.forEach(function(Z,tt){return w(Z,tr[tt])}),tt.update(),O(tl)}else tt.injectAtCaret(ts,window.getSelection().getRangeAt(0));tt.events.callbacks.onMixTagsInput.call(tt,Z)}else tt.injectAtCaret(ts,window.getSelection().getRangeAt(0)),tt.settings.pasteAsTags?te=tt.addTags(tt.state.inputText+ts,!0):(tt.state.inputText=ts,tt.dropdown.show(ts))}tt.trigger("paste",{event:Z,pastedText:tn,clipboardData:ti,tagsElems:te})}).catch(function(Z){return Z}))},onDrop:function(Z){Z.preventDefault()},onEditTagInput:function(Z,tt){var te,ti=Z.closest("."+this.settings.classNames.tag),tn=this.getNodeIndex(ti),ts=w(ti),ta=this.input.normalize.call(this,Z),to=(B(te={},this.settings.tagTextProp,ta),B(te,"__tagId",ts.__tagId),te),tr=this.validateTag(to);this.editTagChangeDetected(u(ts,to))||!0!==Z.originalIsValid||(tr=!0),ti.classList.toggle(this.settings.classNames.tagInvalid,!0!==tr),ts.__isValid=tr,ti.title=!0===tr?ts.title||ts.value:tr,ta.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=ta),this.dropdown.show(ta)),this.trigger("edit:input",{tag:ti,index:tn,data:u({},this.value[tn],{newValue:ta}),event:tt})},onEditTagPaste:function(Z,tt){var te=(tt.clipboardData||window.clipboardData).getData("Text");tt.preventDefault();var ti=y(te);this.setRangeAtStartEnd(!1,ti)},onEditTagClick:function(Z,tt){this.events.callbacks.onClickScope.call(this,tt)},onEditTagFocus:function(Z){this.state.editing={scope:Z,input:Z.querySelector("[contenteditable]")}},onEditTagBlur:function(Z,tt){var te=v.call(this,tt.relatedTarget);if("select"==this.settings.mode&&te&&tt.relatedTarget.contains(tt.target))this.dropdown.hide();else if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(document.activeElement)||this.trigger("blur",{}),this.DOM.scope.contains(Z))){var ti,tn,ts,ta,to=this.settings,tr=Z.closest("."+to.classNames.tag),tl=w(tr),td=this.input.normalize.call(this,Z),tc=(B(tn={},to.tagTextProp,td),B(tn,"__tagId",tl.__tagId),tn),tu=tl.__originalData,tg=this.editTagChangeDetected(u(tl,tc)),th=this.validateTag(tc);if(td){if(tg){if(ts=this.hasMaxTags(),ta=u({},tu,(B(ti={},to.tagTextProp,this.trim(td)),B(ti,"__isValid",th),ti)),to.transformTag.call(this,ta,tu),!0!==(th=(!ts||!0===tu.__isValid)&&this.validateTag(ta))){if(this.trigger("invalid",{data:ta,tag:tr,message:th}),to.editTags.keepInvalid)return;to.keepInvalidTags?ta.__isValid=th:ta=tu}else to.keepInvalidTags&&(delete ta.title,delete ta["aria-invalid"],delete ta.class);this.onEditTagDone(tr,ta)}else this.onEditTagDone(tr,tu)}else this.onEditTagDone(tr)}},onEditTagkeydown:function(Z,tt){if(!this.state.composing)switch(this.trigger("edit:keydown",{event:Z}),Z.key){case"Esc":case"Escape":this.state.editing=!1,tt.__tagifyTagData.__originalData.value?tt.parentNode.replaceChild(tt.__tagifyTagData.__originalHTML,tt):tt.remove();break;case"Enter":case"Tab":Z.preventDefault(),setTimeout(function(){return Z.target.blur()},0)}},onDoubleClickScope:function(Z){if(Z.target){var tt=Z.target.closest("."+this.settings.classNames.tag);if(tt){var te,ti,tn=w(tt),ts=this.settings;!1!==(null==tn?void 0:tn.editable)&&(te=tt.classList.contains(this.settings.classNames.tagEditing),ti=tt.hasAttribute("readonly"),ts.readonly||te||ti||!this.settings.editTags||!ts.userInput||(this.events.callbacks.onEditTagFocus.call(this,tt),this.editTag(tt)),this.toggleFocusClass(!0),"select"!=ts.mode&&this.trigger("dblclick",{tag:tt,index:this.getNodeIndex(tt),data:w(tt)}))}}},onInputDOMChange:function(Z){var tt=this,te=this.DOM.input.lastChild;Z.forEach(function(Z){Z.addedNodes.forEach(function(Z){if("<div><br></div>"==Z.outerHTML)Z.replaceWith(document.createElement("br"));else if(1==Z.nodeType&&Z.querySelector(tt.settings.classNames.tagSelector)){var te,ti,tn=document.createTextNode("");3==Z.childNodes[0].nodeType&&"BR"!=Z.previousSibling.nodeName&&(tn=document.createTextNode("\n")),(ti=Z).replaceWith.apply(ti,U([tn].concat(U(U(Z.childNodes).slice(0,-1))))),T(tn)}else if(v.call(tt,Z)){if(3!=(null===(te=Z.previousSibling)||void 0===te?void 0:te.nodeType)||Z.previousSibling.textContent||Z.previousSibling.remove(),Z.previousSibling&&"BR"==Z.previousSibling.nodeName){Z.previousSibling.replaceWith("\n​");for(var ts=Z.nextSibling,ta="";ts;)ta+=ts.textContent,ts=ts.nextSibling;ta.trim()&&T(Z.previousSibling)}else Z.previousSibling&&!w(Z.previousSibling)||Z.before("​")}}),Z.removedNodes.forEach(function(Z){Z&&"BR"==Z.nodeName&&v.call(tt,te)&&(tt.removeTags(te),tt.fixFirefoxLastTagNoCaret())})}),te&&""==te.nodeValue&&te.remove(),te&&"BR"==te.nodeName||this.DOM.input.appendChild(document.createElement("br"))}}};function z(Z,tt){(null==tt||tt>Z.length)&&(tt=Z.length);for(var te=0,ti=Array(tt);te<tt;te++)ti[te]=Z[te];return ti}function X(Z,tt,te){return tt in Z?Object.defineProperty(Z,tt,{value:te,enumerable:!0,configurable:!0,writable:!0}):Z[tt]=te,Z}function J(Z,tt){return null!=tt&&"undefined"!=typeof Symbol&&tt[Symbol.hasInstance]?!!tt[Symbol.hasInstance](Z):Z instanceof tt}function G(Z){for(var tt=1;tt<arguments.length;tt++){var te=null!=arguments[tt]?arguments[tt]:{},ti=Object.keys(te);"function"==typeof Object.getOwnPropertySymbols&&(ti=ti.concat(Object.getOwnPropertySymbols(te).filter(function(Z){return Object.getOwnPropertyDescriptor(te,Z).enumerable}))),ti.forEach(function(tt){X(Z,tt,te[tt])})}return Z}function $(Z,tt){return tt=null!=tt?tt:{},Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(tt)):(function(Z,tt){var te=Object.keys(Z);if(Object.getOwnPropertySymbols){var ti=Object.getOwnPropertySymbols(Z);te.push.apply(te,ti)}return te})(Object(tt)).forEach(function(te){Object.defineProperty(Z,te,Object.getOwnPropertyDescriptor(tt,te))}),Z}function Q(Z){return function(Z){if(Array.isArray(Z))return z(Z)}(Z)||function(Z){if("undefined"!=typeof Symbol&&null!=Z[Symbol.iterator]||null!=Z["@@iterator"])return Array.from(Z)}(Z)||function(Z,tt){if(Z){if("string"==typeof Z)return z(Z,tt);var te=Object.prototype.toString.call(Z).slice(8,-1);return("Object"===te&&Z.constructor&&(te=Z.constructor.name),"Map"===te||"Set"===te)?Array.from(te):"Arguments"===te||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(te)?z(Z,tt):void 0}}(Z)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(Z,tt){if(!Z){n.warn("input element not found",Z);var te,ti,tn,ts,ta=new Proxy(this,{get:function(){return function(){return ta}}});return ta}if(Z.__tagify)return n.warn("input element is already Tagified - Same instance is returned.",Z),Z.__tagify;u(this,function(Z){var tt=document.createTextNode(""),te={};function ti(Z,te,ti){ti&&te.split(/\s+/g).forEach(function(te){return tt[Z+"EventListener"].call(tt,te,ti)})}return{removeAllCustomListeners:function(){Object.entries(te).forEach(function(Z){var tt=F(Z,2),te=tt[0];tt[1].forEach(function(Z){return ti("remove",te,Z)})}),te={}},off:function(Z,tt){return Z&&(tt?ti("remove",Z,tt):Z.split(/\s+/g).forEach(function(Z){var tt;null===(tt=te[Z])||void 0===tt||tt.forEach(function(tt){return ti("remove",Z,tt)}),delete te[Z]})),this},on:function(Z,tt){return tt&&"function"==typeof tt&&(Z.split(/\s+/g).forEach(function(Z){Array.isArray(te[Z])?te[Z].push(tt):te[Z]=[tt]}),ti("add",Z,tt)),this},trigger:function(te,ti,tn){var ts;if(tn=tn||{cloneData:!0},te){if(Z.settings.isJQueryPlugin)"remove"==te&&(te="removeTag"),jQuery(Z.DOM.originalInput).triggerHandler(te,[ti]);else{try{var ta="object"==typeof ti?ti:{value:ti};if((ta=tn.cloneData?u({},ta):ta).tagify=this,ti.event&&(ta.event=this.cloneEvent(ti.event)),R(ti,Object))for(var to in ti)R(ti[to],HTMLElement)&&(ta[to]=ti[to]);ts=new CustomEvent(te,{detail:ta})}catch(tr){n.warn(tr)}tt.dispatchEvent(ts)}}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,tt=tt||{},this.getPersistedData=(ts=tt.id,function(Z){var tt,te;if(ts){if(1===(null===(tt=localStorage)||void 0===tt?void 0:tt.getItem(L+ts+"/v")))try{te=JSON.parse(localStorage[L+ts+"/"+Z])}catch(ti){}return te}}),this.setPersistedData=(te=tt.id)?(null===(ti=localStorage)||void 0===ti||ti.setItem(L+te+"/v",1),function(Z,tt){var ti,tn=JSON.stringify(Z);Z&&tt&&(null===(ti=localStorage)||void 0===ti||ti.setItem(L+te+"/"+tt,tn),dispatchEvent(new Event("storage")))}):function(){},this.clearPersistedData=(tn=tt.id,function(Z){var tt=L+"/"+tn+"/";if(Z)localStorage.removeItem(tt+Z);else for(var te in localStorage)te.includes(tt)&&localStorage.removeItem(te)}),this.applySettings(Z,tt),this.state={inputText:"",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(Z),A.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),Z.autofocus&&this.DOM.input.focus(),Z.__tagify=this}Y.prototype={_dropdown:k,placeCaretAfterNode:T,getSetTagData:w,helpers:{sameStr:a,removeCollectionProp:s,omit:o,isObject:c,parseHTML:r,escapeHTML:d,extend:u,concatWithoutDups:g,getUID:f,isNodeTag:v},customEventsList:["change","add","remove","invalid","input","paste","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim:function(Z){return this.settings.trim&&Z&&"string"==typeof Z?Z.trim():Z},parseHTML:r,templates:j,parseTemplate:function(Z,tt){return r((Z=this.settings.templates[Z]||Z).apply(this,tt))},set whitelist(t){var Z=t&&Array.isArray(t);this.settings.whitelist=Z?t:[],this.setPersistedData(Z?t:[],"whitelist")},get whitelist(){return this.settings.whitelist},set userInput(t){this.settings.userInput=!!t,this.setContentEditable(!!t)},get userInput(){return this.settings.userInput},generateClassSelectors:function(Z){for(var tt in Z)(function(tt){var te=tt;Object.defineProperty(Z,te+"Selector",{get:function(){return"."+this[te].split(" ")[0]}})})(tt)},applySettings:function(Z,tt){x.templates=this.templates;var te,ti,tn=u({},x,"mix"==tt.mode?{pasteAsTags:!1,dropdown:{position:"text"}}:{}),ts=this.settings=u({},tn,tt);if(ts.disabled=Z.hasAttribute("disabled"),ts.readonly=ts.readonly||Z.hasAttribute("readonly"),ts.placeholder=d(Z.getAttribute("placeholder")||ts.placeholder||""),ts.required=Z.hasAttribute("required"),this.generateClassSelectors(ts.classNames),this.isIE&&(ts.autoComplete=!1),["whitelist","blacklist"].forEach(function(tt){var te=Z.getAttribute("data-"+tt);te&&J(te=te.split(ts.delimiters),Array)&&(ts[tt]=te)}),"autoComplete"in tt&&!c(tt.autoComplete)&&(ts.autoComplete=x.autoComplete,ts.autoComplete.enabled=tt.autoComplete),"mix"==ts.mode&&(ts.pattern=ts.pattern||/@/,ts.autoComplete.rightKey=!0,ts.delimiters=tt.delimiters||null,ts.tagTextProp&&!ts.dropdown.searchKeys.includes(ts.tagTextProp)&&ts.dropdown.searchKeys.push(ts.tagTextProp)),Z.pattern)try{ts.pattern=RegExp(Z.pattern)}catch(ta){}if(ts.delimiters){ts._delimiters=ts.delimiters;try{ts.delimiters=RegExp(this.settings.delimiters,"g")}catch(to){}}(ts.disabled||ts.readonly)&&(ts.userInput=!1),this.TEXTS=G({},P,ts.texts||{}),"select"==ts.mode&&(ts.dropdown.includeSelectedTags=!0),("select"!=ts.mode||(null===(te=tt.dropdown)||void 0===te?void 0:te.enabled))&&ts.userInput||(ts.dropdown.enabled=0),ts.disabled&&(ts.dropdown.enabled=!1),ts.dropdown.appendTarget=(null===(ti=tt.dropdown)||void 0===ti?void 0:ti.appendTarget)||document.body,void 0===ts.dropdown.includeSelectedTags&&(ts.dropdown.includeSelectedTags=ts.duplicates);var tr=this.getPersistedData("whitelist");Array.isArray(tr)&&(this.whitelist=Array.isArray(ts.whitelist)?g(ts.whitelist,tr):tr)},getAttributes:function(Z){var tt,te=this.getCustomAttributes(Z),ti="";for(tt in te)ti+=" "+tt+(void 0!==Z[tt]?'="'.concat(te[tt],'"'):"");return ti},getCustomAttributes:function(Z){if(!c(Z))return"";var tt,te={};for(tt in Z)"__"!=tt.slice(0,2)&&"class"!=tt&&Z.hasOwnProperty(tt)&&void 0!==Z[tt]&&(te[tt]=d(Z[tt]));return te},setStateSelection:function(){var Z=window.getSelection(),tt={anchorOffset:Z.anchorOffset,anchorNode:Z.anchorNode,range:Z.getRangeAt&&Z.rangeCount&&Z.getRangeAt(0)};return this.state.selection=tt,tt},getCSSVars:function(){var Z,tt,te,ti=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(tt=(Z=function(Z){if(!Z)return{};var tt=(Z=Z.trim().split(" ")[0]).split(/\d+/g).filter(function(Z){return Z}).pop().trim();return{value:+Z.split(tt).filter(function(Z){return Z})[0].trim(),unit:tt}}((te="tag-hide-transition",ti.getPropertyValue("--"+te)))).value,"s"==Z.unit?1e3*tt:tt)}},build:function(Z){var tt=this.DOM,te=Z.closest("label");this.settings.mixMode.integrated?(tt.originalInput=null,tt.scope=Z,tt.input=Z):(tt.originalInput=Z,tt.originalInput_tabIndex=Z.tabIndex,tt.scope=this.parseTemplate("wrapper",[Z,this.settings]),tt.input=tt.scope.querySelector(this.settings.classNames.inputSelector),Z.parentNode.insertBefore(tt.scope,Z),Z.tabIndex=-1),te&&te.setAttribute("for","")},destroy:function(){var Z,tt,te;this.events.unbindGlobal.call(this),null===(Z=this.DOM.scope.parentNode)||void 0===Z||Z.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),this.removeAllCustomListeners(),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(null===(te=this.listeners)||void 0===te||null===(tt=te.main)||void 0===tt?void 0:tt.originalInputValueObserverInterval)},loadOriginalValues:function(Z){var tt,te=this.settings;if(this.state.blockChangeEvent=!0,void 0===Z){var ti=this.getPersistedData("value");Z=ti&&!this.DOM.originalInput.value?ti:te.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),Z){if("mix"==te.mode)this.parseMixTags(Z),(tt=this.DOM.input.lastChild)&&"BR"==tt.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{J(JSON.parse(Z),Array)&&(Z=JSON.parse(Z))}catch(tn){}this.addTags(Z,!0).forEach(function(Z){return Z&&Z.classList.add(te.classNames.tagNoAnimation)})}}else this.postUpdate();this.state.lastOriginalValueReported=te.mixMode.integrated?"":this.DOM.originalInput.value},cloneEvent:function(Z){var tt={};for(var te in Z)"path"!=te&&(tt[te]=Z[te]);return tt},loading:function(Z){return this.state.isLoading=Z,this.DOM.scope.classList[Z?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading:function(Z,tt){return Z&&Z.classList[tt?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass:function(Z,tt){"string"==typeof Z&&this.DOM.scope.classList.toggle(Z,tt)},toggleScopeValidation:function(Z){var tt=!0===Z||void 0===Z;!this.settings.required&&Z&&Z===this.TEXTS.empty&&(tt=!0),this.toggleClass(this.settings.classNames.tagInvalid,!tt),this.DOM.scope.title=tt?"":Z},toggleFocusClass:function(Z){this.toggleClass(this.settings.classNames.focus,!!Z)},setPlaceholder:function(Z){var tt=this;["data","aria"].forEach(function(te){return tt.DOM.input.setAttribute("".concat(te,"-placeholder"),Z)})},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var Z=this.DOM.originalInput,tt=this.state.lastOriginalValueReported!==Z.value,te=new CustomEvent("change",{bubbles:!0});tt&&(this.state.lastOriginalValueReported=Z.value,te.simulated=!0,Z._valueTracker&&Z._valueTracker.setValue(Math.random()),Z.dispatchEvent(te),this.trigger("change",this.state.lastOriginalValueReported),Z.value=this.state.lastOriginalValueReported)}},events:K,fixFirefoxLastTagNoCaret:function(){},setRangeAtStartEnd:function(Z,tt){if(tt){Z="number"==typeof Z?Z:!!Z,tt=tt.lastChild||tt;var te=document.getSelection();if(J(te.focusNode,Element)&&!this.DOM.input.contains(te.focusNode))return!0;try{te.rangeCount>=1&&["Start","End"].forEach(function(ti){return te.getRangeAt(0)["set"+ti](tt,Z||tt.length)})}catch(ti){console.warn(ti)}}},insertAfterTag:function(Z,tt){if(tt=tt||this.settings.mixMode.insertAfterTag,Z&&Z.parentNode&&tt)return tt="string"==typeof tt?document.createTextNode(tt):tt,Z.parentNode.insertBefore(tt,Z.nextSibling),tt},editTagChangeDetected:function(Z){var tt=Z.__originalData;for(var te in tt)if(!this.dataProps.includes(te)&&Z[te]!=tt[te])return!0;return!1},getTagTextNode:function(Z){return Z.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode:function(Z,tt){this.getTagTextNode(Z).innerHTML=d(tt)},editTag:function(Z,tt){var te=this;Z=Z||this.getLastTag(),tt=tt||{};var ti=this.settings,tn=this.getTagTextNode(Z),ts=this.getNodeIndex(Z),ta=w(Z),to=this.events.callbacks,tr=!0,tl="select"==ti.mode;if(tl||this.dropdown.hide(),tn){if(!J(ta,Object)||!("editable"in ta)||ta.editable)return ta=w(Z,{__originalData:u({},ta),__originalHTML:Z.cloneNode(!0)}),w(ta.__originalHTML,ta.__originalData),tn.setAttribute("contenteditable",!0),Z.classList.add(ti.classNames.tagEditing),this.events.callbacks.onEditTagFocus.call(this,Z),tn.addEventListener("click",to.onEditTagClick.bind(this,Z)),tn.addEventListener("blur",to.onEditTagBlur.bind(this,this.getTagTextNode(Z))),tn.addEventListener("input",to.onEditTagInput.bind(this,tn)),tn.addEventListener("paste",to.onEditTagPaste.bind(this,tn)),tn.addEventListener("keydown",function(tt){return to.onEditTagkeydown.call(te,tt,Z)}),tn.addEventListener("compositionstart",to.onCompositionStart.bind(this)),tn.addEventListener("compositionend",to.onCompositionEnd.bind(this)),tt.skipValidation||(tr=this.editTagToggleValidity(Z)),tn.originalIsValid=tr,this.trigger("edit:start",{tag:Z,index:ts,data:ta,isValid:tr}),tn.focus(),tl||this.setRangeAtStartEnd(!1,tn),0!==ti.dropdown.enabled||tl||this.dropdown.show(),this.state.hasFocus=!0,this}else n.warn("Cannot find element in Tag template: .",ti.classNames.tagTextSelector)},editTagToggleValidity:function(Z,tt){var te;if(tt=tt||w(Z))return(te=!("__isValid"in tt)||!0===tt.__isValid)||this.removeTagsFromValue(Z),this.update(),Z.classList.toggle(this.settings.classNames.tagNotAllowed,!te),tt.__isValid=te,tt.__isValid;n.warn("tag has no data: ",Z,tt)},onEditTagDone:function(Z,tt){Z=Z||this.state.editing.scope,tt=tt||{};var te,ti,tn=this.settings,ts={tag:Z,index:this.getNodeIndex(Z),previousData:w(Z),data:tt};this.trigger("edit:beforeUpdate",ts,{cloneData:!1}),this.state.editing=!1,delete tt.__originalData,delete tt.__originalHTML,Z&&Z.parentNode&&((void 0!==(ti=tt[tn.tagTextProp])?null===(te=(ti+="").trim)||void 0===te?void 0:te.call(ti):tn.tagTextProp in tt?void 0:tt.value)?(Z=this.replaceTag(Z,tt),this.editTagToggleValidity(Z,tt),tn.a11y.focusableTags?Z.focus():"select"!=tn.mode&&T(Z)):this.removeTags(Z)),this.trigger("edit:updated",ts),tn.dropdown.closeOnSelect&&this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function(Z,tt){tt&&""!==tt.value&&void 0!==tt.value||(tt=Z.__tagifyTagData),tt.__isValid&&1!=tt.__isValid&&u(tt,this.getInvalidTagAttrs(tt,tt.__isValid));var te=this.createTagElem(tt);return Z.parentNode.replaceChild(te,Z),this.updateValueByDOMTags(),te},updateValueByDOMTags:function(){var Z=this;this.value.length=0;var tt=this.settings.classNames,te=[tt.tagNotAllowed.split(" ")[0],tt.tagHide];[].forEach.call(this.getTagElms(),function(tt){Q(tt.classList).some(function(Z){return te.includes(Z)})||Z.value.push(w(tt))}),this.update(),this.dropdown.refilter()},injectAtCaret:function(Z,tt){if(tt=tt||(null===(te=this.state.selection)||void 0===te?void 0:te.range),"string"==typeof Z&&(Z=document.createTextNode(Z)),!Z)return this;var te,ti=11===Z.nodeType?Array.prototype.slice.call(Z.childNodes):[Z];if(!ti.length)return this;if(!tt)return this.appendMixTags(Z),this;if(!this.DOM.scope.contains(null==tt?void 0:tt.startContainer))return this;y(Z,tt);var tn=ti[ti.length-1]||Z;return(null==tn?void 0:tn.parentNode)&&T(tn),this.setStateSelection(),this.updateValueByDOMTags(),this.update(),this},input:{set:function(){var Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",tt=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],te=this.settings,ti=te.dropdown.closeOnSelect;this.state.inputText=Z,tt&&(this.DOM.input.innerHTML=d(""+Z),Z&&this.toggleClass(te.classNames.empty,!this.DOM.input.innerHTML)),!Z&&ti&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw:function(){return this.DOM.input.textContent},validate:function(){var Z=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!Z),Z},normalize:function(Z,tt){var te=Z||this.DOM.input,ti=[];te.childNodes.forEach(function(Z){return 3==Z.nodeType&&ti.push(Z.nodeValue)}),ti=ti.join("\n");try{ti=ti.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(tn){}return ti=ti.replace(/\s/g," "),(null==tt?void 0:tt.trim)?this.trim(ti):ti},autocomplete:{suggest:function(Z){if(this.settings.autoComplete.enabled){"object"!=typeof(Z=Z||{value:""})&&(Z={value:Z});var tt=this.dropdown.getMappedValue(Z);if("number"!=typeof tt){var te=this.state.inputText.toLowerCase(),ti=tt.substr(0,this.state.inputText.length).toLowerCase(),tn=tt.substring(this.state.inputText.length);tt&&this.state.inputText&&ti==te?(this.DOM.input.setAttribute("data-suggest",tn),this.state.inputSuggestion=Z):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}}},set:function(Z){var tt=this.DOM.input.getAttribute("data-suggest"),te=Z||(tt?this.state.inputText+tt:null);return!!te&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+te)):(this.input.set.call(this,te),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function(Z){return this.value.findIndex(function(tt){return tt.__tagId==(Z||{}).__tagId})},getNodeIndex:function(Z){var tt=0;if(Z)for(;Z=Z.previousElementSibling;)tt++;return tt},getTagElms:function(){for(var Z=arguments.length,tt=Array(Z),te=0;te<Z;te++)tt[te]=arguments[te];var ti="."+Q(this.settings.classNames.tag.split(" ")).concat(Q(tt)).join(".");return[].slice.call(this.DOM.scope.querySelectorAll(ti))},getLastTag:function(){var Z=this.settings.classNames,tt=this.DOM.scope.querySelectorAll("".concat(Z.tagSelector,":not(.").concat(Z.tagHide,"):not([readonly])"));return tt[tt.length-1]},isTagDuplicate:function(Z,tt,te){var ti=0,tn=!0,ts=!1,ta=void 0;try{for(var to,tr=this.value[Symbol.iterator]();!(tn=(to=tr.next()).done);tn=!0){var tl=to.value;a(this.trim(""+Z),tl.value,tt)&&te!=tl.__tagId&&ti++}}catch(td){ts=!0,ta=td}finally{try{tn||null==tr.return||tr.return()}finally{if(ts)throw ta}}return ti},getTagIndexByValue:function(Z){var tt=this,te=[],ti=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach(function(tn,ts){tn.__tagifyTagData&&a(tt.trim(tn.__tagifyTagData.value),Z,ti)&&te.push(ts)}),te},getTagElmByValue:function(Z){var tt=this.getTagIndexByValue(Z)[0];return this.getTagElms()[tt]},flashTag:function(Z){var tt=this;Z&&(Z.classList.add(this.settings.classNames.tagFlash),setTimeout(function(){Z.classList.remove(tt.settings.classNames.tagFlash)},100))},isTagBlacklisted:function(Z){return Z=this.trim(Z.toLowerCase()),this.settings.blacklist.filter(function(tt){return(""+tt).toLowerCase()==Z}).length},isTagWhitelisted:function(Z){return!!this.getWhitelistItem(Z)},getWhitelistItem:function(Z,tt,te){tt=tt||"value";var ti,tn=this.settings;return(te=te||tn.whitelist).some(function(te){if(a("object"==typeof te?te[tt]||te.value:te,Z,tn.dropdown.caseSensitive,tn.trim))return ti="object"==typeof te?te:{value:te},!0}),ti||"value"!=tt||"value"==tn.tagTextProp||(ti=this.getWhitelistItem(Z,tn.tagTextProp,te)),ti},validateTag:function(Z){var tt=this.settings,te="value"in Z?"value":tt.tagTextProp,ti=this.trim(Z[te]+"");return(Z[te]+"").trim()?"mix"!=tt.mode&&tt.pattern&&J(tt.pattern,RegExp)&&!tt.pattern.test(ti)?this.TEXTS.pattern:!tt.duplicates&&this.isTagDuplicate(ti,tt.dropdown.caseSensitive,Z.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(ti)||tt.enforceWhitelist&&!this.isTagWhitelisted(ti)?this.TEXTS.notAllowed:!tt.validate||tt.validate(Z):this.TEXTS.empty},getInvalidTagAttrs:function(Z,tt){return{"aria-invalid":!0,class:"".concat(Z.class||""," ").concat(this.settings.classNames.tagNotAllowed).trim(),title:tt}},hasMaxTags:function(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function(Z,tt){var te=this.settings;this.DOM.scope.contains(document.activeElement)&&document.activeElement.blur(),te[tt||"readonly"]=Z,this.DOM.scope[(Z?"set":"remove")+"Attribute"](tt||"readonly",!0),this.settings.userInput=!0,this.setContentEditable(!Z),Z||(this.events.binding.call(this,!0),this.events.binding.call(this))},setContentEditable:function(Z){this.DOM.scope.querySelectorAll("[data-can-editable]").forEach(function(tt){tt.contentEditable=Z,tt.tabIndex=Z?0:-1})},setDisabled:function(Z){this.setReadonly(Z,"disabled")},normalizeTags:function(Z){var tt=this,te=this.settings,ti=te.whitelist,tn=te.delimiters,ts=te.mode,ta=te.tagTextProp,to=[],tr=!!ti&&J(ti[0],Object),tl=Array.isArray(Z),td=tl&&Z[0].value,tc=function(Z){return(Z+"").split(tn).reduce(function(Z,te){var ti,tn=tt.trim(te);return tn&&Z.push((X(ti={},ta,tn),X(ti,"value",tn),ti)),Z},[])};if("number"==typeof Z&&(Z=Z.toString()),"string"==typeof Z){if(!Z.trim())return[];Z=tc(Z)}else tl&&(Z=Z.reduce(function(Z,te){if(c(te)){var ti,tn=u({},te);ta in tn||(ta="value"),tn[ta]=tt.trim(tn[ta]),(tn[ta]||0===tn[ta])&&Z.push(tn)}else null!=te&&""!==te&&void 0!==te&&(ti=Z).push.apply(ti,Q(tc(te)));return Z},[]));return tr&&!td&&(Z.forEach(function(Z){var te=to.map(function(Z){return Z.value}),ti=tt.dropdown.filterListItems.call(tt,Z[ta],{exact:!0});tt.settings.duplicates||(ti=ti.filter(function(Z){return!te.includes(Z.value)}));var tn=ti.length>1?tt.getWhitelistItem(Z[ta],ta,ti):ti[0];tn&&J(tn,Object)?to.push(tn):"mix"!=ts&&(null==Z.value&&(Z.value=Z[ta]),to.push(Z))}),to.length&&(Z=to)),Z},parseMixTags:function(Z,tt){var te=this,ti=this.settings,tn=ti.mixTagsInterpolator,ts=ti.duplicates,ta=ti.transformTag,to=ti.enforceWhitelist,tr=ti.maxTags,tl=ti.tagTextProp,td=null==tt?void 0:tt.skipDOM,tc=td?document.createDocumentFragment():null,tu=[];if(Z=Z.split(tn[0]).map(function(Z,tt){var ti,tg,th,tp=Z.split(tn[1]),tf=tp[0],tv=tu.length==tr;if(td&&0==tt&&Z)return tc.appendChild(document.createTextNode(Z)),"";try{if(tf==+tf)throw Error;tg=JSON.parse(tf)}catch(tm){tg=te.normalizeTags(tf)[0]||{value:tf}}if(ta.call(te,tg),tv||!(tp.length>1)||to&&!te.isTagWhitelisted(tg.value)||!ts&&te.isTagDuplicate(tg.value)){if(Z)return td?(tc.appendChild(document.createTextNode(tn[0]+Z)),""):tt?tn[0]+Z:Z}else{if(tg[ti=tg[tl]?tl:"value"]=te.trim(tg[ti]),th=te.createTagElem(tg),tu.push(tg),th.classList.add(te.settings.classNames.tagNoAnimation),td)return tc.appendChild(th),tp[1]&&tc.appendChild(document.createTextNode(tp[1])),"";tp[0]=th.outerHTML,te.value.push(tg)}return tp.join("")}).join(""),td)return tc.__tagifyTagsData=tu,tc;this.DOM.input.innerHTML=Z,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize();var tg=this.getTagElms();return tg.forEach(function(Z,tt){return w(Z,tu[tt])}),this.update({withoutChangeEvent:!0}),O(tg,this.state.hasFocus),Z},convertPastedTextToMixTags:function(Z){var tt=this.settings,te=tt.pattern,ti=tt.whitelist,tn=tt.mixTagsInterpolator,ts=tt.mixTagsAllowedAfter,ta=tt.tagTextProp;if(!te||!(null==ti?void 0:ti.length))return Z;var to=te.source?te.source.split("|"):[te],tr={};to.forEach(function(Z){tr[Z.replace(/\\/g,"")]=ti.map(function(Z){var tt;return tt="string"==typeof Z?Z:Z[ta]||Z.value,{originalItem:Z,value:tt=String(tt),searchValue:tt.toLowerCase()}}).sort(function(Z,tt){return tt.value.length-Z.value.length})});for(var tl,td=RegExp(te.source,"g"),tc=[];null!==(tl=td.exec(Z));){var tu=tl[0],tg=tl.index,th=tg+tu.length,tp=Z.slice(th),tf=tr[tu];if(tf){var tv=null,tm=0,tw=!0,tT=!1,ty=void 0;try{for(var tb,t$=tf[Symbol.iterator]();!(tw=(tb=t$.next()).done);tw=!0){var tx=tb.value,tD=tx.value.length;if(tp.slice(0,tD).toLowerCase()===tx.searchValue){var tO=tp[tD];if(!tO||ts.test(tO)){tv=tx,tm=tD;break}}}}catch(tI){tT=!0,ty=tI}finally{try{tw||null==t$.return||t$.return()}finally{if(tT)throw ty}}if(tv){var tS="string"==typeof tv.originalItem?{value:tv.value,prefix:tu}:$(G({},tv.originalItem),{prefix:tu});if(!0===this.validateTag(tS)){var tM="".concat(tn[0]).concat(JSON.stringify(tS)).concat(tn[1]);tc.push({start:tg,end:th+tm,replacement:tM}),td.lastIndex=th+tm}}}}var tE=Z;return tc.reverse().forEach(function(Z){var tt=Z.start,te=Z.end,ti=Z.replacement;tE=tE.slice(0,tt)+ti+tE.slice(te)}),tE},replaceTextWithNode:function(Z,tt){if(this.state.tag||tt){tt=tt||this.state.tag.prefix+this.state.tag.value;var te,ti,tn=this.state.selection||window.getSelection(),ts=tn.anchorNode,ta=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return ts.splitText(tn.anchorOffset-ta),-1==(te=ts.nodeValue.lastIndexOf(tt))||(ti=ts.splitText(te),Z&&ts.parentNode.replaceChild(Z,ti),!0)}},prepareNewTagNode:function(Z,tt){tt=tt||{};var te=this.settings,ti=[],tn={},ts=Object.assign({},Z,{value:Z.value+""});if(Z=Object.assign({},ts),te.transformTag.call(this,Z),Z.__isValid=this.hasMaxTags()||this.validateTag(Z),!0!==Z.__isValid){if(tt.skipInvalid)return;if(u(tn,this.getInvalidTagAttrs(Z,Z.__isValid),{__preInvalidData:ts}),Z.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(Z.value)),!te.createInvalidTags)return void ti.push(Z.value)}return"readonly"in Z&&(Z.readonly?tn["aria-readonly"]=!0:delete Z.readonly),{tagElm:this.createTagElem(Z,tn),tagData:Z,aggregatedInvalidInput:ti}},postProcessNewTagNode:function(Z,tt){var te=this,ti=this.settings,tn=tt.__isValid;tn&&!0===tn?this.value.push(tt):(this.trigger("invalid",{data:tt,index:this.value.length,tag:Z,message:tn}),ti.keepInvalidTags||setTimeout(function(){return te.removeTags(Z,!0)},1e3)),this.dropdown.position()},selectTag:function(Z,tt){var te=this;if(!this.settings.enforceWhitelist||this.isTagWhitelisted(tt.value)){this.state.actions.selectOption&&setTimeout(function(){return te.setRangeAtStartEnd(!1,te.DOM.input)});var ti=this.getLastTag();return ti?this.replaceTag(ti,tt):this.appendTag(Z),this.value[0]=tt,this.update(),this.trigger("add",{tag:Z,data:tt}),[Z]}},addEmptyTag:function(Z){var tt=u({value:""},Z||{}),te=this.createTagElem(tt);w(te,tt),this.appendTag(te),this.editTag(te,{skipValidation:!0}),this.toggleFocusClass(!0)},addTags:function(Z,tt,te){var ti=this,tn=[],ts=this.settings,ta=[],to=document.createDocumentFragment(),tr=[];if(!Z||0==Z.length)return tn;switch(Z=this.normalizeTags(Z),ts.mode){case"mix":return this.addMixTags(Z);case"select":tt=!1,this.removeAllTags()}return this.DOM.input.removeAttribute("style"),Z.forEach(function(Z){var tt=ti.prepareNewTagNode(Z,{skipInvalid:te||ts.skipInvalid});if(tt){var tl=tt.tagElm;if(Z=tt.tagData,ta=tt.aggregatedInvalidInput,tn.push(tl),"select"==ts.mode)return ti.selectTag(tl,Z);to.appendChild(tl),ti.postProcessNewTagNode(tl,Z),tr.push({tagElm:tl,tagData:Z})}}),this.appendTag(to),tr.forEach(function(Z){var tt=Z.tagElm,te=Z.tagData;return ti.trigger("add",{tag:tt,index:ti.getTagIdx(te),data:te})}),this.update(),Z.length&&tt&&(this.input.set.call(this,ts.createInvalidTags?"":ta.join(ts._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),this.dropdown.refilter(),tn},addMixTags:function(Z){var tt=this;if((Z=this.normalizeTags(Z))[0].prefix||this.state.tag)return this.prefixedTextToTag(Z[0]);var te=document.createDocumentFragment(),ti=[];return Z.forEach(function(Z){var tn=tt.prepareNewTagNode(Z);te.appendChild(tn.tagElm),tt.insertAfterTag(tn.tagElm),tt.postProcessNewTagNode(tn.tagElm,tn.tagData),ti.push({tagElm:tn.tagElm,tagData:tn.tagData})}),this.appendMixTags(te,ti),te.children},appendMixTags:function(Z,tt){var te,ti=null===(te=this.state.selection)||void 0===te?void 0:te.range,tn=!!ti&&this.DOM.scope.contains(ti.startContainer),ts=Z?11===Z.nodeType?Array.prototype.slice.call(Z.childNodes):[Z]:[];if(tn)this.injectAtCaret(Z);else{this.DOM.input.focus();var ta=this.setStateSelection();(null==ta?void 0:ta.range)&&(ta.range.setStart(this.DOM.input,ta.range.endOffset),ta.range.setEnd(this.DOM.input,ta.range.endOffset)),this.DOM.input.appendChild(Z),this.updateValueByDOMTags(),this.update();var to=ts[ts.length-1];(null==to?void 0:to.parentNode)&&T(to),this.setStateSelection()}var tr=(null==tt?void 0:tt.length)?tt:ts.filter(function(Z){return 1===Z.nodeType});(null==tr?void 0:tr.length)&&this.trigger("add",{tags:tr})},prefixedTextToTag:function(Z){var tt,te,ti,tn=this,ts=this.settings,ta=null===(tt=this.state.tag)||void 0===tt?void 0:tt.delimiters;return Z.prefix=Z.prefix||this.state.tag?this.state.tag.prefix:(ts.pattern.source||ts.pattern)[0],te=(ti=this.prepareNewTagNode(Z)).tagElm,this.replaceTextWithNode(te)||this.DOM.input.appendChild(te),setTimeout(function(){return te.classList.add(tn.settings.classNames.tagNoAnimation)},300),this.update(),!ta&&setTimeout(T,0,this.insertAfterTag(te)||te),this.state.tag=null,this.postProcessNewTagNode(te,ti.tagData),this.trigger("add",{tag:ti,data:Z}),te},appendTag:function(Z){var tt=this.DOM,te=tt.input;tt.scope.insertBefore(Z,te)},createTagElem:function(Z,tt){Z.__tagId=f();var te,ti,tn=u({},Z,G((X(te={},this.settings.tagTextProp,d((Z[this.settings.tagTextProp]||Z.value)+"")),X(te,"title",d((Z.title||"")+"")),X(te,"value",d(Z.value+"")),te),tt));return function(Z){for(var tt,te=document.createNodeIterator(Z,NodeFilter.SHOW_TEXT,null,!1);tt=te.nextNode();)tt.textContent.trim()||tt.parentNode.removeChild(tt)}(ti=this.parseTemplate("tag",[tn,this])),w(ti,Z),ti},reCheckInvalidTags:function(){var Z=this,tt=this.settings;this.getTagElms(tt.classNames.tagNotAllowed).forEach(function(te,ti){var tn=w(te),ts=Z.hasMaxTags(),ta=Z.validateTag(tn);if("select"==tt.mode&&Z.toggleScopeValidation(ta),!0===ta&&!ts)return tn=tn.__preInvalidData?tn.__preInvalidData:{value:tn.value},Z.replaceTag(te,tn);te.title=ts||ta})},removeTags:function(Z,tt,te){var ti,tn=this,ts=this.settings;if(ti=(Z=Z&&J(Z,HTMLElement)?[Z]:J(Z,Array)?Z:Z?[Z]:[this.getLastTag()].filter(function(Z){return Z})).reduce(function(Z,tt){tt&&"string"==typeof tt&&(tt=tn.getTagElmByValue(tt));var te=w(tt);return tt&&te&&!te.readonly&&Z.push({node:tt,idx:tn.getTagIdx(te),data:w(tt,{__removed:!0})}),Z},[]),te="number"==typeof te?te:this.CSSVars.tagHideTransition,"select"==ts.mode&&(te=0,this.input.set.call(this)),1==ti.length&&"select"!=ts.mode&&ti[0].node.classList.contains(ts.classNames.tagNotAllowed)&&(tt=!0),ti.length)return ts.hooks.beforeRemoveTag(ti,{tagify:this}).then(function(){var Z=function(Z){Z.node.parentNode&&(Z.node.parentNode.removeChild(Z.node),tt?ts.keepInvalidTags&&this.trigger("remove",{tag:Z.node,index:Z.idx}):(this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),ts.keepInvalidTags&&this.reCheckInvalidTags(),this.trigger("remove",{tag:Z.node,index:Z.idx,data:Z.data})))};tt||(tn.removeTagsFromValue(ti.map(function(Z){return Z.node})),tn.update(),"select"==ts.mode&&ts.userInput&&tn.setContentEditable(!0)),te&&te>10&&1==ti.length?(function(tt){tt.node.style.width=parseFloat(window.getComputedStyle(tt.node).width)+"px",document.body.clientTop,tt.node.classList.add(ts.classNames.tagHide),setTimeout(Z.bind(this),te,tt)}).call(tn,ti[0]):ti.forEach(Z.bind(tn))}).catch(function(Z){})},removeTagsFromDOM:function(){this.getTagElms().forEach(function(Z){return Z.remove()})},removeTagsFromValue:function(Z){var tt=this;(Z=Array.isArray(Z)?Z:[Z]).forEach(function(Z){var te=w(Z),ti=tt.getTagIdx(te);ti>-1&&tt.value.splice(ti,1)})},removeAllTags:function(Z){var tt=this;Z=Z||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout(function(){tt.DOM.input.focus()}),"select"==this.settings.mode&&(this.input.set.call(this),this.settings.userInput&&this.setContentEditable(!0));var te=this.state.blockChangeEvent?void 0:function(){tt.state.blockChangeEvent||tt.trigger("remove",{})};this.update(Z,te)},postUpdate:function(){this.state.blockChangeEvent=!1;var Z,tt,te=this.settings,ti=te.classNames,tn="mix"==te.mode?te.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(ti.hasMaxTags,this.value.length>=te.maxTags),this.toggleClass(ti.hasNoTags,!this.value.length),this.toggleClass(ti.empty,!tn),"select"==te.mode&&this.toggleScopeValidation(null===(tt=this.value)||void 0===tt||null===(Z=tt[0])||void 0===Z?void 0:Z.__isValid)},setOriginalInputValue:function(Z){var tt=this.DOM.originalInput;this.settings.mixMode.integrated||(tt.value=Z,tt.tagifyValue=tt.value)},update:function(Z,tt){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout((function(){this.setPersistedData(te,"value"),this.settings.onChangeAfterBlur&&(Z||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent(),this.postUpdate(),null==tt||tt()}).bind(this),100),this.events.bindOriginaInputListener.call(this,100);var te=this.getInputValue();this.setOriginalInputValue(te)},getInputValue:function(){var Z=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(Z):Z.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(Z):JSON.stringify(Z):""},getCleanValue:function(Z){return s(Z||this.value,this.dataProps)},getMixedTagsAsString:function(){var Z="",tt=this,te=this.settings,ti=te.originalInputValueFormat||JSON.stringify,tn=te.mixTagsInterpolator;return function te(ts){ts.childNodes.forEach(function(ts){if(1==ts.nodeType){var ta=w(ts);if("BR"==ts.tagName&&(Z+="\r\n"),ta&&v.call(tt,ts)){if(ta.__removed)return;Z+=tn[0]+ti(o(ta,tt.dataProps))+tn[1]}else ts.getAttribute("style")||["B","I","U"].includes(ts.tagName)?Z+=ts.textContent:"DIV"!=ts.tagName&&"P"!=ts.tagName||(Z+="\r\n",te(ts))}else Z+=ts.textContent})}(this.DOM.input),Z}},Y.prototype.removeTag=Y.prototype.removeTags;export{Y as default};